# 请求响应对象分层与使用规范

> 目标：统一 `refinex-base` 与 `refinex-web` 两套请求/响应对象的职责边界，避免跨层混用。

## 1. 分层结论

- `Interfaces(Web API)` 层：只使用 `Result`、`PageResult` 作为对前端返回模型。
- `Application/Domain` 层：使用 `BaseRequest`、`PageRequest`、`BaseResponse`、`SingleResponse`、`MultiResponse`、
  `PageResponse`、`RestResponse` 作为内部语义模型。
- `跨服务（Service to Service）`：优先使用 `SingleResponse` / `MultiResponse` / `PageResponse`，由调用方在适配层转换。
- `Controller` 禁止直接返回 `SingleResponse` / `MultiResponse` 给前端页面接口。

---

## 2. 各对象用途与侧重

### 2.1 请求对象

#### `BaseRequest`

- 位置：`refinex-common/refinex-base/src/main/java/cn/refinex/base/request/BaseRequest.java`
- 用途：应用层命令/查询对象的统一父类，承载通用请求语义（序列化、可扩展元信息）。
- 场景：Application Service 入参、内部 Command/Query DTO。

#### `PageRequest`

- 位置：`refinex-common/refinex-base/src/main/java/cn/refinex/base/request/PageRequest.java`
- 用途：分页查询基类（`currentPage`、`pageSize`）。
- 场景：所有“列表查询页面”对应的 Query 对象应继承它。

---

### 2.2 Base 层响应对象

#### `BaseResponse`

- 位置：`refinex-common/refinex-base/src/main/java/cn/refinex/base/response/BaseResponse.java`
- 用途：内部响应统一父类（`success`、`responseCode`、`responseMessage`）。
- 场景：内部服务返回基础元信息。

#### `SingleResponse<T>`

- 位置：`refinex-common/refinex-base/src/main/java/cn/refinex/base/response/SingleResponse.java`
- 用途：内部单对象返回。
- 场景：应用层/服务间单对象调用。

#### `MultiResponse<T>`

- 位置：`refinex-common/refinex-base/src/main/java/cn/refinex/base/response/MultiResponse.java`
- 用途：内部列表返回（不带分页元数据）。
- 场景：小集合、配置型列表、非页面化场景。

#### `PageResponse<T>`

- 位置：`refinex-common/refinex-base/src/main/java/cn/refinex/base/response/PageResponse.java`
- 用途：内部分页返回（列表 + `total/currentPage/pageSize/totalPage`）。
- 场景：所有页面型列表查询在应用层和仓储层统一使用。

#### `RestResponse<T>`

- 位置：`refinex-common/refinex-base/src/main/java/cn/refinex/base/response/RestResponse.java`
- 用途：对外部三方 REST 返回进行适配时的兼容模型。
- 场景：集成第三方平台时的中间态对象，不作为前端统一返回模型。

---

### 2.3 Web 层响应对象

#### `Result<T>`

- 位置：`refinex-common/refinex-web/src/main/java/cn/refinex/web/vo/Result.java`
- 用途：前端接口统一返回模型（单对象、无分页列表、操作结果）。
- 场景：Controller 对外 API 默认返回。

#### `PageResult<T>`

- 位置：`refinex-common/refinex-web/src/main/java/cn/refinex/web/vo/PageResult.java`
- 用途：前端分页返回模型。
- 场景：所有页面列表查询接口统一返回。

---

## 3. DDD 分层映射建议

- `Interfaces`：Request VO（可继承 `PageRequest`） -> Assembler -> Application Command/Query。
- `Application`：返回 `SingleResponse` / `PageResponse`（内部语义），由 Controller 转换为 `Result` / `PageResult`。
- `Domain`：聚焦实体与领域规则，不关心 `Result/PageResult`。
- `Infrastructure`：仓储可直接返回 `PageResponse<Entity>` 给应用层，避免 Controller 直接接触持久化细节。

---

## 4. 统一约束

- 列表查询接口：
    - 入参必须继承 `PageRequest`。
    - 返回必须为 `PageResult`。
- 非分页查询接口：
    - 返回必须为 `Result`。
- 前端页面接口禁止返回：
    - `SingleResponse`、`MultiResponse`、`RestResponse`。
- 内部 HTTP Client 可继续使用 `SingleResponse` / `PageResponse`，在网关/适配层完成转换。

---

## 5. 迁移指引

- 新增接口：直接按本规范实现，不再引入 `SingleResponse/MultiResponse` 到 Controller。
- 存量接口：优先改“列表接口”到 `PageRequest + PageResult`，再逐步将单对象接口收敛到 `Result`。
- 前端适配：统一按 `Result/PageResult` 解析，分页组件只消费 `total/page/size/data`。
